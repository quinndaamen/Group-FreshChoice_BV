@model IEnumerable<FreshChoice.Services.Item.Models.ItemModel>

<link rel="stylesheet" href="~/css/inventory-management.css" />
<link rel="stylesheet" href="~/css/custom-dropdown.css" />

<div class="inventory-page">
    <div class="inventory-container">
        <!-- Header -->
        <div class="header">
            <div class="header-text">
                <h2>Inventory Management</h2>
                <p>Manage stocks</p>
            </div>
            <div>
                <a asp-action="Create" class="btn-primary">
                    <i class="bi bi-plus-lg"></i> Add Product
                </a>
            </div>
        </div>

        <!-- Stock Alert -->
        @{
            var outOfStockCount = Model.Count(i => i.Quantity == 0);
            var lowStockCount = Model.Count(i => i.Quantity > 0 && i.Quantity < 10);
        }
        
        @if (outOfStockCount > 0)
        {
            <div class="alert-banner alert-danger">
                <i class="bi bi-x-circle"></i>
                <div class="alert-content">
                    <strong>Out of Stock Alert</strong>
                    <span>@outOfStockCount product(s) completely out of stock</span>
                </div>
            </div>
        }
        
        @if (lowStockCount > 0)
        {
            <div class="alert-banner alert-warning">
                <i class="bi bi-exclamation-circle"></i>
                <div class="alert-content">
                    <strong>Low Stock Alert</strong>
                    <span>@lowStockCount product(s) running low on stock</span>
                </div>
            </div>
        }

        <!-- Search and Filter -->
        <div class="search-filter-row">
            <div class="search-container">
                <i class="bi bi-search"></i>
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Search by product name or SKU..." 
                />
            </div>
            <div class="custom-dropdown small">
                <select id="categoryFilter" class="category-filter">
                    <option value="All Categories">All Categories</option>
                    <option value="Dairy">Dairy</option>
                    <option value="Bakery">Bakery</option>
                    <option value="Produce">Produce</option>
                    <option value="Meat">Meat</option>
                    <option value="General">General</option>
                </select>
            </div>
        </div>

        <!-- Table -->
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>SKU</th>
                        <th>Product Name</th>
                        <th>Category</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="inventoryTableBody">
                    @foreach (var item in Model)
                    {
                        var stockStatus = item.Quantity == 0 ? "out-stock" : (item.Quantity < 10 ? "low-stock" : "in-stock");
                        var stockLabel = item.Quantity == 0 ? "Out of Stock" : (item.Quantity < 10 ? "Low Stock" : "In Stock");
                        
                        // Get category name and CSS class from enum
                        var categoryName = item.Category.ToString();
                        var categoryClass = $"category-{categoryName.ToLower()}";
                        
                        <tr class="inventory-row" 
                            data-search="@item.Name ITEM-@item.Id.ToString().PadLeft(3, '0')" 
                            data-category="@categoryName"
                            data-item-id="@item.Id">
                            <td class="sku-cell">ITEM-@item.Id.ToString().PadLeft(3, '0')</td>
                            <td class="product-name">@item.Name</td>
                            <td>
                                <span class="category-badge @categoryClass">@categoryName</span>
                            </td>
                            <td class="quantity-cell" data-quantity="@item.Quantity">
                                <span class="quantity-value">@item.Quantity</span>
                            </td>
                            <td class="price-cell">€@item.Price.ToString("F2")</td>
                            <td>
                                <span class="status-badge @stockStatus">@stockLabel</span>
                            </td>
                            <td>
                                <div class="action-btns">
                                    <button class="btn-action btn-plus" onclick="adjustStock(@item.Id, 1)" title="Increase quantity">
                                        +
                                    </button>
                                    <button class="btn-action btn-minus" onclick="adjustStock(@item.Id, -1)" title="Decrease quantity">
                                        −
                                    </button>
                                    <a asp-action="Edit" asp-route-id="@item.Id" class="btn-action btn-edit" title="Edit product">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <form asp-action="Delete" asp-route-id="@item.Id" method="post" style="display:inline;">
                                        <button type="submit" class="btn-action btn-delete" onclick="return confirm('Delete this item?');" title="Delete product">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Empty State -->
        @if (!Model.Any())
        {
            <div class="empty-state" id="emptyState">
                <i class="bi bi-box-seam"></i>
                <p>No products found</p>
            </div>
        }

        <!-- No Results Message (Hidden by default) -->
        <div class="empty-state" id="noResultsState" style="display: none;">
            <i class="bi bi-search"></i>
            <p>No products found</p>
        </div>
    </div>
</div>

<script src="~/js/inventory-management.js"></script>
<script src="~/js/custom-dropdown.js"></script>